<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pixel Brush</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }

      #settingsWrapper {
        width: 300px;
        position: absolute;
        top: 10px;
        right: 10px;
        z-index: 2;
        background: rgba(255, 255, 255, 0.8);
        padding: 10px;
        border-radius: 8px;
      }

      .slider {
        -webkit-appearance: none;
        width: 100%;
        height: 25px;
        background: #d3d3d3;
        outline: none;
        opacity: 0.7;
        margin: 10px 0;
      }

      .slider:hover {
        opacity: 1;
      }

      .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 25px;
        height: 25px;
        background: #04aa6d;
        cursor: pointer;
      }

      .slider::-moz-range-thumb {
        width: 25px;
        height: 25px;
        background: #04aa6d;
        cursor: pointer;
      }

      canvas {
        display: block;
      }
    </style>
  </head>
  <body>
    <section id="settingsWrapper">
      <label>Brush Size: <span id="brushSizeValue">20</span></label>
      <input
        type="range"
        min="5"
        max="50"
        value="20"
        class="slider"
        id="brushSizeSlider"
      />

      <label>Pixel Block: <span id="pixelBlockValue">10</span></label>
      <input
        type="range"
        min="2"
        max="50"
        value="10"
        class="slider"
        id="pixelBlockSlider"
      />
    </section>

    <canvas id="canvas"></canvas>

    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      // Sliders
      const brushSizeSlider = document.getElementById("brushSizeSlider");
      const pixelBlockSlider = document.getElementById("pixelBlockSlider");
      const brushSizeValue = document.getElementById("brushSizeValue");
      const pixelBlockValue = document.getElementById("pixelBlockValue");

      let brushSize = Number(brushSizeSlider.value);
      let pixelBlock = Number(pixelBlockSlider.value);

      brushSizeSlider.addEventListener("input", () => {
        brushSize = Number(brushSizeSlider.value);
        brushSizeValue.textContent = brushSize;
      });

      pixelBlockSlider.addEventListener("input", () => {
        pixelBlock = Number(pixelBlockSlider.value);
        pixelBlockValue.textContent = pixelBlock;
      });

      // Load image
      const img = new Image();
      img.src = "img.jpg"; // ⚠️ Udskift med din egen billede-fil

      img.onload = () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const canvasRatio = canvas.width / canvas.height;
        const imgRatio = img.width / img.height;

        let drawWidth, drawHeight, offsetX, offsetY;

        if (canvasRatio > imgRatio) {
          drawWidth = canvas.width;
          drawHeight = canvas.width / imgRatio;
          offsetX = 0;
          offsetY = (canvas.height - drawHeight) / 2;
        } else {
          drawHeight = canvas.height;
          drawWidth = canvas.height * imgRatio;
          offsetY = 0;
          offsetX = (canvas.width - drawWidth) / 2;
        }

        ctx.drawImage(img, offsetX, offsetY, drawWidth, drawHeight);
      };

      // Pixelate on mousemove
      canvas.addEventListener("mousemove", (e) => {
        if (e.buttons !== 1) return; // kun når musen holdes nede (venstre klik)

        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        // Sørg for at brush ikke går udenfor canvas
        const safeBrushSize = Math.min(
          brushSize,
          canvas.width - x,
          canvas.height - y
        );

        const imgData = ctx.getImageData(x, y, safeBrushSize, safeBrushSize);
        const data = imgData.data;

        for (let py = 0; py < safeBrushSize; py += pixelBlock) {
          for (let px = 0; px < safeBrushSize; px += pixelBlock) {
            const i = (py * safeBrushSize + px) * 4;
            const r = data[i];
            const g = data[i + 1];
            const b = data[i + 2];

            ctx.fillStyle = `rgb(${r},${g},${b})`;
            ctx.fillRect(x + px, y + py, pixelBlock, pixelBlock);
          }
        }
      });

      // Resize canvas dynamically
      window.addEventListener("resize", () => {
        const temp = ctx.getImageData(0, 0, canvas.width, canvas.height);
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        ctx.putImageData(temp, 0, 0);
      });
    </script>
  </body>
</html>
