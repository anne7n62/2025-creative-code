<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pixel Brush</title>
    <style>
* {
  box-sizing: border-box;
}
  body {
    margin: 0;
    overflow: hidden;
    background: #000;
    font-family: "IBM Plex Mono", "Courier New", monospace;
    color: #f5f5f5;
  }

  /* Subtle CRT scanlines */
  body::before {
    content: "";
    position: fixed;
    inset: 0;
    background: repeating-linear-gradient(
      to bottom,
      rgba(255, 255, 255, 0.03) 0px,
      rgba(255, 255, 255, 0.03) 1px,
      transparent 1px,
      transparent 3px
    );
    pointer-events: none;
    z-index: 5;
  }

  label {
    color: #ff94f8; /* neon pink cyberfem glow */
    font-size: 13px;
    letter-spacing: 1px;
    text-transform: uppercase;
  }

  #settingsWrapper {
    width: 320px;
    position: absolute;
    top: 20px;
    right: 20px;
    z-index: 10;
    background: rgba(0, 0, 0, 0.8);
    border: 2px solid #ff94f8;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 0 25px #ff94f850, inset 0 0 10px #ff94f820;
    backdrop-filter: blur(4px);
  }

  /* SLIDERS */
  .slider {
    -webkit-appearance: none;
    width: 100%;
    height: 8px;
    background: #111;
    border: 1px solid #ff94f8;
    outline: none;
    margin: 12px 0 20px;
    position: relative;
  }

  .slider:hover {
    box-shadow: 0 0 10px #ff94f8;
  }

  .slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 22px;
    height: 22px;
    background: #ff94f8;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 0 10px #ff94f8, 0 0 20px #ff94f8;
  }

  .slider::-moz-range-thumb {
    width: 22px;
    height: 22px;
    background: #ff94f8;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 0 10px #ff94f8, 0 0 20px #ff94f8;
  }


  /* HIDE the original input completely */
#filInput {
  width: 0.1px;
  height: 0.1px;
  opacity: 0;
  position: absolute;
  z-index: -1;
}

/* Custom cyberpunk neon button */
#fileLabel {
  display: block;
  width: 100%;
  padding: 12px;
  border: 2px dashed #ff94f8;
  background: transparent;
  color: #ff94f8;
  text-align: center;
  cursor: pointer;
  text-transform: uppercase;
  font-size: 12px;
  letter-spacing: 1px;
  border-radius: 4px;
  transition: 0.2s;
  box-shadow: 0 0 8px #ff94f830;
}

#fileLabel:hover {
  background: #ff94f810;
  box-shadow: 0 0 12px #ff94f860, inset 0 0 6px #ff94f820;
}


  /* CANVAS */
  canvas {
    display: block;
    background: black;
  }
</style>

    </style>
  </head>
  <body>
    <section id="settingsWrapper">
      <label>Brush Size: <span id="brushSizeValue">20</span></label>
      <input
        type="range"
        min="5"
        max="50"
        value="20"
        class="slider"
        id="brushSizeSlider"
      />

      <label>Pixel Block: <span id="pixelBlockValue">10</span></label>
      <input
        type="range"
        min="2"
        max="50"
        value="10"
        class="slider"
        id="pixelBlockSlider"
      />

     <label id="fileLabel" for="filInput">Choose Image</label>
<input type="file" id="filInput" accept="image/*" />
    </section>

    <canvas id="canvas"></canvas>

    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      // Sliders
      const brushSizeSlider = document.getElementById("brushSizeSlider");
      const pixelBlockSlider = document.getElementById("pixelBlockSlider");
      const brushSizeValue = document.getElementById("brushSizeValue");
      const pixelBlockValue = document.getElementById("pixelBlockValue");

      let brushSize = Number(brushSizeSlider.value);
      let pixelBlock = Number(pixelBlockSlider.value);

      brushSizeSlider.addEventListener("input", () => {
        brushSize = Number(brushSizeSlider.value);
        brushSizeValue.textContent = brushSize;
      });

      pixelBlockSlider.addEventListener("input", () => {
        pixelBlock = Number(pixelBlockSlider.value);
        pixelBlockValue.textContent = pixelBlock;
      });

      // Load image
      const img = new Image();
      img.src = "img.jpg"; // ⚠️ Udskift med din egen billede-fil

      const filInput = document.getElementById("filInput");

      // Når brugeren vælger et billede
      filInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();

        reader.onload = function (event) {
          img.src = event.target.result; // brug det nye billede
        };

        reader.readAsDataURL(file);
      });

      img.onload = () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const canvasRatio = canvas.width / canvas.height;
        const imgRatio = img.width / img.height;

        let drawWidth, drawHeight, offsetX, offsetY;

        if (canvasRatio > imgRatio) {
          drawWidth = canvas.width;
          drawHeight = canvas.width / imgRatio;
          offsetX = 0;
          offsetY = (canvas.height - drawHeight) / 2;
        } else {
          drawHeight = canvas.height;
          drawWidth = canvas.height * imgRatio;
          offsetY = 0;
          offsetX = (canvas.width - drawWidth) / 2;
        }

        ctx.drawImage(img, offsetX, offsetY, drawWidth, drawHeight);
      };

      // Pixelate on mousemove
      canvas.addEventListener("mousemove", (e) => {
        //if (e.buttons !== 1) return; // kun når musen holdes nede (venstre klik)

        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        // Sørg for at brush ikke går udenfor canvas
        const safeBrushSize = Math.min(
          brushSize,
          canvas.width - x,
          canvas.height - y
        );

        const imgData = ctx.getImageData(x, y, safeBrushSize, safeBrushSize);
        const data = imgData.data;

        for (let py = 0; py < safeBrushSize; py += pixelBlock) {
          for (let px = 0; px < safeBrushSize; px += pixelBlock) {
            const i = (py * safeBrushSize + px) * 4;
            const r = data[i];
            const g = data[i + 1];
            const b = data[i + 2];

            ctx.fillStyle = `rgb(${r},${g},${b})`;
            ctx.fillRect(x + px, y + py, pixelBlock, pixelBlock);
          }
        }
      });

      // Resize canvas dynamically
      window.addEventListener("resize", () => {
        const temp = ctx.getImageData(0, 0, canvas.width, canvas.height);
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        ctx.putImageData(temp, 0, 0);
      });
    </script>
  </body>
</html>
